<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Zeitplan - {{ event.Bezeichnung }}</title>
    <style>
        body { font-family: sans-serif; }
        @page { size: A4; margin: 2.5cm 1.5cm 1.5cm 1.5cm; }

        .print-header { position: fixed; top: 0; left: 0; right: 0; height: 2cm; text-align: center; }
        .print-header h1, .print-header h2 { margin: 0; }
        .print-header h2 { font-size: 1.2em; }
        .print-header h1 { font-size: 1em; color: #666; font-weight: normal; }

        main { padding-top: 2cm; }
        
        /* NEU: Jeder Ring auf einer neuen Seite (Punkt 2) */
        .ring-page { page-break-after: always; }
        .ring-page:last-child { page-break-after: auto; }

        table { width: 100%; border-collapse: collapse; font-size: 10pt; margin-top: 1cm;}
        th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
        th { background-color: #f2f2f2; }
        h3 { text-align: left; margin-top: 1.5cm; }
    </style>
</head>
<body>
    <header class="print-header">
        <h1>{{ event.Bezeichnung }} - {{ event.Datum | format_date }}</h1>
        <h2>Zeitplan</h2>
    </header>

    <main>
        {% for ring, timeline in timelines_by_ring.items()|sort %}
        <div class="ring-page">
            <h3>Zeitplan Ring {{ ring }} (Start: {{ event.start_times_by_ring.get('ring_' + ring, 'N/A') }})</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 15%;">Start</th>
                        <th style="width: 15%;">Ende</th>
                        <th>Aktion</th>
                        {# NEU: Richter statt Dauer (Punkt 1) #}
                        <th style="width: 25%;">Richter</th>
                        <th style="width: 15%;">Starter</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in timeline %}
                    <tr>
                        <td>{{ item.start_time }}</td>
                        <td>{{ item.end_time }}</td>
                        <td>
                            {% if item.block.laufart in ['Pause', 'Umbau', 'Vorbereitung', 'Briefing', 'Grossring'] %}
                                <strong>{{ item.block.laufart|upper }}</strong> - {{ item.block.label }}
                            {% else %}
                                {{ item.block.laufart }} {{ item.block.kategorie }} {{ item.block.klasse }}
                            {% endif %}
                        </td>
                        <td>
                            {# NEU: Richter wird angezeigt #}
                            {% if item.block.richter_id %}
                                {{ judges_map.get(item.block.richter_id, 'N/A') }}
                            {% endif %}
                        </td>
                        <td>{{ item.num_starters if item.num_starters > 0 else '' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5">Für diesen Ring sind keine Blöcke geplant.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
    </main>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Master-Einweiserliste - {{ event.Bezeichnung }}</title>
    <style>
        body { font-family: sans-serif; }
        @page { size: A4 landscape; margin: 2.5cm 1cm 1cm 1cm; }

        /* NEU: Header, der sich auf jeder Seite wiederholt (Punkt 5) */
        .print-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 2cm;
            text-align: center;
        }
        .print-header h1, .print-header h2 { margin: 0; }
        .print-header h2 { font-size: 1.2em; }
        .print-header h1 { font-size: 1em; color: #666; font-weight: normal; }

        .group-container { page-break-after: always; padding-top: 1cm; }
        .group-container:last-child { page-break-after: auto; }

        table { width: 100%; border-collapse: collapse; font-size: 8pt; margin-top: 5px; table-layout: fixed; }
        th, td { border: 1px solid #ccc; padding: 4px; text-align: left; vertical-align: middle; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        th.run-header { background-color: #f2f2f2; text-align: center; writing-mode: vertical-lr; transform: rotate(180deg); }
        h3 { background-color: #e9ecef; font-size: 14pt; padding: 8px; text-align: left;}
        
        .checkbox { width: 18px; height: 18px; border: 1px solid black; display: block; margin: auto; }
        .participant-col { width: 60px; }
        .run-col { width: 25px; }
        .run-header { height: 150px; }

        main { padding-top: 2.5cm; }
    </style>
</head>
<body>
    <header class="print-header">
        <h1>{{ event.Bezeichnung }} - {{ event.Datum | format_date }}</h1>
        <h2>Master-Einweiserliste</h2>
    </header>

    <main>
        {% for cat, classes in final_grouped_data.items()|sort %}
            {% for cls, group_data in classes.items()|sort %}
                <div class="group-container">
                    <h3>Kategorie: {{ cat }} - Klasse: {{ cls }}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="participant-col" style="writing-mode: horizontal-tb; transform: none; height: auto;">Start-Nr.</th>
                                <th class="participant-col" style="width: 150px; writing-mode: horizontal-tb; transform: none; height: auto;">Hundef√ºhrer</th>
                                <th class="participant-col" style="width: 120px; writing-mode: horizontal-tb; transform: none; height: auto;">Hund</th>
                                {% for run in group_data.runs %}
                                    <th class="run-col run-header"><div>{{ run.name }}</div></th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in group_data.participants %}
                            <tr>
                                <td><strong>{{ p.Startnummer }}</strong></td>
                                <td>{{ p.Hundefuehrer }}</td>
                                <td>{{ p.Hundename }}</td>
                                {% for run in group_data.runs %}
                                    <td style="text-align: center;">
                                        {% if group_data.run_map[p.Lizenznummer][run.id] %}
                                            <div class="checkbox"></div>
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        {% endfor %}
    </main>
</body>
</html>
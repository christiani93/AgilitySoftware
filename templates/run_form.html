{% extends "layout.html" %}
{% block title %}Lauf bearbeiten: {{ run.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Lauf bearbeiten <small class="text-muted"> - {{ run.name }}</small></h1>
        <a href="{{ url_for('events_bp.manage_runs', event_id=event.id) }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Zurück</a>
    </div>

    <form method="POST">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="name" class="form-label">Lauf-Name</label>
                        <input type="text" id="name" name="name" class="form-control" value="{{ run.name }}">
                    </div>
                    <div class="col-md-6">
                        <label for="richter_id" class="form-label">Richter</label>
                        <select id="richter_id" name="richter_id" class="form-select">
                            <option value="">Bitte wählen...</option>
                            {% for judge in judges %}<option value="{{ judge.id }}" {% if run.richter_id == judge.id %}selected{% endif %}>{{ judge.lastname }}, {{ judge.firstname }}</option>{% endfor %}
                        </select>
                    </div>

                    <div class="col-12"><hr><h5>Parcours- & Zeitdaten</h5></div>

                    <div class="col-md-6">
                        <label for="parcours_laenge" class="form-label">Parcourslänge (in Meter)</label>
                        <input type="number" step="0.1" id="parcours_laenge" name="parcours_laenge" class="form-control" value="{{ run.laufdaten.parcours_laenge or '' }}">
                    </div>
                    <div class="col-md-6">
                        <label for="anzahl_hindernisse" class="form-label">Anzahl Hindernisse</label>
                        <input type="number" id="anzahl_hindernisse" name="anzahl_hindernisse" class="form-control" value="{{ run.laufdaten.anzahl_hindernisse or '' }}">
                    </div>

                    {% if run.klasse == '1' or run.klasse == 'Oldie' %}
                    <div class="col-12">
                        <p class="form-text">Für Klasse 1/Oldie, wählen Sie eine SCT-Berechnungsmethode:</p>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="sct_method" id="sct_speed" value="speed" {{ 'checked' if not run.laufdaten.get('sct_direkt') }}>
                            <label class="form-check-label" for="sct_speed">Nach Geschwindigkeit</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="sct_method" id="sct_direct" value="direct" {{ 'checked' if run.laufdaten.get('sct_direkt') }}>
                            <label class="form-check-label" for="sct_direct">Direkte Eingabe</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="geschwindigkeit" class="form-label">Geschwindigkeit (m/s)</label>
                        <input type="number" step="0.01" id="geschwindigkeit" name="geschwindigkeit" class="form-control" value="{{ run.laufdaten.geschwindigkeit or '' }}">
                    </div>
                     <div class="col-md-6">
                        <label for="standardzeit_sct" class="form-label">Standardzeit direkt (s)</label>
                        <input type="number" step="0.01" id="standardzeit_sct" name="standardzeit_sct" class="form-control" value="{{ run.laufdaten.standardzeit_sct if run.laufdaten.get('sct_direkt') else '' }}">
                    </div>
                    {% else %}
                    <div class="col-12">
                        <div class="alert alert-info">
                            <strong>Hinweis für Klasse 2 & 3:</strong><br>
                            Die <strong>Maximalzeit (MCT)</strong> und <strong>Standardzeit (SCT)</strong> werden automatisch basierend auf der Parcourslänge und den Faktoren in den Einstellungen berechnet.
                        </div>
                    </div>
                    {% endif %}
                </div>
                <hr>
                <button type="submit" class="btn btn-primary">Speichern</button>
                <a href="{{ url_for('events_bp.manage_runs', event_id=event.id) }}" class="btn btn-secondary">Abbrechen</a>
            </div>
        </div>
    </form>
</div>
{% endblock %}
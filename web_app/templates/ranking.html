{% extends "layout.html" %}
{% block title %}Rangliste: {{ run.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 no-print">
    <div>
        <h1 class="mb-0">Rangliste: {{ run.name }}</h1>
        <p class="text-muted fs-5">{{ event.Bezeichnung }}</p>
    </div>
    <div>
        <a href="{{ url_for('live_bp.live_run_entry', event_id=event.id, run_id=run.id) }}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Zurück zur Erfassung</a>
        <a href="{{ url_for('print_bp.print_ranking_single', event_id=event.id, run_id=run.id) }}" target="_blank" class="btn btn-primary"><i class="fas fa-print me-2"></i>Druckversion</a>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header">
        <div class="d-flex flex-column flex-md-row gap-2 justify-content-between">
            <span>Parcourslänge: {{ run.laufdaten.parcours_laenge or 'N/A' }}m</span>
            <span>SCT: {{ sct_display }}s</span>
            <span>MCT: {{ mct_display }}s</span>
            <span>Richter: {{ judge_display or '—' }}</span>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-bordered mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Rang</th>
                        <th>#</th>
                        <th>Hund / Hundeführer</th>
                        <th>Zeit</th>
                        <th>Fehler</th>
                        <th>Verw.</th>
                        <th>Zeitfehler</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in rankings %}
                    <tr>
                        <td>{{ entry.platz or (entry.result.disqualifikation if entry.result) or '' }}</td>
                        <td>{{ entry.Startnummer }}</td>
                        <td><strong>{{ entry.Hundename }}</strong><br><small>{{ entry.Hundefuehrer }}</small></td>
                        <td>{{ "%.2f"|format(entry.zeit_total|float) if entry.zeit_total else '-' }}</td>
                        <td>{{ entry.fehler_parcours|int if entry.fehler_parcours is defined else '-' }}</td>
                        <td>{{ entry.verweigerung_parcours|int if entry.verweigerung_parcours is defined else '-' }}</td>
                        <td>{{ "%.2f"|format(entry.fehler_zeit|float) if entry.fehler_zeit is defined else '-' }}</td>
                        <td><strong>{{ "%.2f"|format(entry.fehler_total|float) if entry.fehler_total < 998 else '-' }}</strong></td>
                    </tr>
                    {% else %}
                    <tr><td colspan="8" class="text-center p-4">Noch keine Resultate für die Rangliste erfasst.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

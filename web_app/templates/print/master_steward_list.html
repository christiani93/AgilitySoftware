<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Master-Einweiserliste - {{ event.Bezeichnung }}</title>
    <style>
        body { font-family: sans-serif; }
        :root { --print-header-height: 90px; }
        @page { size: A4; margin: 25mm 10mm 15mm 10mm; }

        /* NEU: Header, der sich auf jeder Seite wiederholt (Punkt 5) */
        .print-header { position: fixed; top: 0; left: 0; right: 0; height: var(--print-header-height); display: flex; align-items: center; justify-content: space-between; gap: 1rem; background: #fff; z-index: 10; }
        .print-header__logo { width: 2.5cm; display: flex; align-items: center; justify-content: center; }
        .print-header__logo-box { width: 2.2cm; height: 2.2cm; border: 1px solid #999; background: #f5f5f5; color: #666; font-size: 9pt; display: flex; align-items: center; justify-content: center; text-align: center; }
        .print-header__titles { text-align: center; flex: 1; font-size: 10pt; }
        .print-header__title { font-size: 1.1em; font-weight: 600; }
        .print-header__subtitle { font-size: 0.95em; color: #555; margin-bottom: 2px; }
        .print-header__meta { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; font-size: 9pt; color: #444; }

        .group-container { page-break-after: always; padding-top: 1cm; }
        .group-container:last-child { page-break-after: auto; }

        table { width: 100%; border-collapse: collapse; font-size: 8pt; margin-top: 5px; table-layout: fixed; }
        th, td { border: 1px solid #ccc; padding: 4px; text-align: left; vertical-align: middle; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        th.run-header { background-color: #f2f2f2; text-align: center; writing-mode: vertical-lr; transform: rotate(180deg); }
        h3 { background-color: #e9ecef; font-size: 14pt; padding: 8px; text-align: left;}
        
        .checkbox { width: 18px; height: 18px; border: 1px solid black; display: block; margin: auto; }
        .participant-col { width: 60px; }
        .run-col { width: 25px; }
        .run-header { height: 150px; }

        main { margin-top: 0; }

        table { page-break-inside: auto; }
        thead { display: table-header-group; }
        tr { page-break-inside: avoid; page-break-after: auto; }

        @media print {
            body { margin: 0; }
            main { margin-top: 0 !important; padding-top: 0 !important; }
        }
    </style>
</head>
<body>
    {% set title = 'Master-Einweiserliste' %}
    {% include 'print/_print_header.html' %}

    <main>
        {% for cat, classes in final_grouped_data.items()|sort %}
            {% for cls, group_data in classes.items()|sort %}
                <div class="group-container">
                    <h3>Kategorie: {{ cat }} - Klasse: {{ cls }}</h3>
                    <table>
                        <thead>
                            <tr>
                                <th class="participant-col" style="writing-mode: horizontal-tb; transform: none; height: auto;">Start-Nr.</th>
                                <th class="participant-col" style="width: 150px; writing-mode: horizontal-tb; transform: none; height: auto;">Hundef√ºhrer</th>
                                <th class="participant-col" style="width: 120px; writing-mode: horizontal-tb; transform: none; height: auto;">Hund</th>
                                {% for run in group_data.runs %}
                                    <th class="run-col run-header"><div>{{ run.name }}</div></th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in group_data.participants %}
                            <tr>
                                <td><strong>{{ p.Startnummer }}</strong></td>
                                <td>{{ p.Hundefuehrer }}</td>
                                <td>{{ p.Hundename }}</td>
                                {% for run in group_data.runs %}
                                    <td style="text-align: center;">
                                        {% if group_data.run_map[p.Lizenznummer][run.id] %}
                                            <div class="checkbox"></div>
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        {% endfor %}
    </main>
</body>
</html>
